{"version":3,"file":"index.js","sources":["../../src/util/suit.js","../../src/mixins/suit.js","../../src/util/polyfills.js","../../src/util/vue-compat/index-vue2.js","../../src/util/warn.js","../../src/mixins/widget.js","../../src/mixins/panel.js","../../src/components/Configure.js","../../src/components/ConfigureRelatedItems.js","../../src/util/unescape.js","../../src/util/parseAlgoliaHit.js","../../src/components/Highlighter.vue","../../src/components/Index.js","../../src/util/createInstantSearchComponent.js","../../src/components/InstantSearch.js","../../src/components/InstantSearchSsr.js","../../src/components/QueryRuleContext.js","../../src/components/DynamicWidgets.js","../../src/components/ExperimentalDynamicWidgets.js","../../src/plugin.js","../../src/util/createServerRootMixin.js"],"sourcesContent":["/**\n * Create class names like ais-widgetName-element--modifier\n *\n * @param {string} widgetName first part\n * @param {string} element part separated by -\n * @param {string} modifier final part, separated by --\n *\n * @returns {string} the composed class name\n */\nexport default function suit(widgetName, element, modifier) {\n  if (!widgetName) {\n    throw new Error('You need to provide `widgetName` in your data');\n  }\n\n  const elements = [`ais-${widgetName}`];\n\n  if (element) {\n    elements.push(`-${element}`);\n  }\n\n  if (modifier) {\n    elements.push(`--${modifier}`);\n  }\n\n  return elements.join('');\n}\n","import suit from '../util/suit';\n\nexport const createSuitMixin = ({ name }) => ({\n  props: {\n    classNames: {\n      type: Object,\n      default: undefined,\n    },\n  },\n  methods: {\n    suit(element, modifier) {\n      const className = suit(name, element, modifier);\n      const userClassName = this.classNames && this.classNames[className];\n      if (userClassName) {\n        return [className, userClassName].join(' ');\n      }\n      return className;\n    },\n  },\n});\n","/* eslint-disable eslint-comments/no-unlimited-disable */\n/* eslint-disable */\n\n// source: @babel/plugin-proposal-object-rest-spread@7.2.0\n// prettier-ignore\nexport function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\n// source: @babel/plugin-proposal-object-rest-spread@7.2.0\n// prettier-ignore\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n","import Vue from 'vue';\n\nconst isVue2 = true;\nconst isVue3 = false;\nconst Vue2 = Vue;\nconst version = Vue.version;\n\nexport { Vue, Vue2, isVue2, isVue3, version };\n\nexport function renderCompat(fn) {\n  return function (createElement) {\n    return fn.call(this, createElement);\n  };\n}\n\nexport function getDefaultSlot(component) {\n  return component.$slots.default;\n}\n\n// Vue3-only APIs\nexport const computed = undefined;\nexport const createApp = undefined;\nexport const createSSRApp = undefined;\nexport const createRef = undefined;\nexport const customRef = undefined;\nexport const defineAsyncComponent = undefined;\nexport const defineComponent = undefined;\nexport const del = undefined;\nexport const getCurrentInstance = undefined;\nexport const h = undefined;\nexport const inject = undefined;\nexport const isRaw = undefined;\nexport const isReactive = undefined;\nexport const isReadonly = undefined;\nexport const isRef = undefined;\nexport const markRaw = undefined;\nexport const nextTick = undefined;\nexport const onActivated = undefined;\nexport const onBeforeMount = undefined;\nexport const onBeforeUnmount = undefined;\nexport const onBeforeUpdate = undefined;\nexport const onDeactivated = undefined;\nexport const onErrorCaptured = undefined;\nexport const onMounted = undefined;\nexport const onServerPrefetch = undefined;\nexport const onUnmounted = undefined;\nexport const onUpdated = undefined;\nexport const provide = undefined;\nexport const proxyRefs = undefined;\nexport const reactive = undefined;\nexport const readonly = undefined;\nexport const ref = undefined;\nexport const set = undefined;\nexport const shallowReactive = undefined;\nexport const shallowReadonly = undefined;\nexport const shallowRef = undefined;\nexport const toRaw = undefined;\nexport const toRef = undefined;\nexport const toRefs = undefined;\nexport const triggerRef = undefined;\nexport const unref = undefined;\nexport const useCSSModule = undefined;\nexport const useCssModule = undefined;\nexport const warn = undefined;\nexport const watch = undefined;\nexport const watchEffect = undefined;\n","const cache = new Set();\n\nexport function warn(message) {\n  if (cache.has(message)) return;\n  cache.add(message);\n  // eslint-disable-next-line no-console\n  console.warn(message);\n}\n","import { _objectSpread } from '../util/polyfills';\nimport { isVue3 } from '../util/vue-compat';\nimport { warn } from '../util/warn';\n\nexport const createWidgetMixin = (\n  { connector } = {},\n  additionalProperties = {}\n) => ({\n  inject: {\n    instantSearchInstance: {\n      from: '$_ais_instantSearchInstance',\n      default() {\n        const tag = this.$options._componentTag;\n        throw new TypeError(\n          `It looks like you forgot to wrap your Algolia search component \"<${tag}>\" inside of an \"<ais-instant-search>\" component.`\n        );\n      },\n    },\n    getParentIndex: {\n      from: '$_ais_getParentIndex',\n      default() {\n        return () => this.instantSearchInstance.mainIndex;\n      },\n    },\n  },\n  data() {\n    return {\n      state: null,\n    };\n  },\n  created() {\n    if (typeof connector === 'function') {\n      this.factory = connector(this.updateState, () => {});\n      this.widget = _objectSpread(\n        this.factory(this.widgetParams),\n        additionalProperties\n      );\n      this.getParentIndex().addWidgets([this.widget]);\n\n      if (\n        this.instantSearchInstance._initialResults &&\n        !this.instantSearchInstance.started\n      ) {\n        if (typeof this.instantSearchInstance.__forceRender !== 'function') {\n          throw new Error(\n            'You are using server side rendering with <ais-instant-search> instead of <ais-instant-search-ssr>.'\n          );\n        }\n        this.instantSearchInstance.__forceRender(\n          this.widget,\n          this.getParentIndex()\n        );\n      }\n    } else if (connector !== true) {\n      warn(\n        `You are using the InstantSearch widget mixin, but didn't provide a connector.\nWhile this is technically possible, and will give you access to the Helper,\nit's not the recommended way of making custom components.\n\nIf you want to disable this message, pass { connector: true } to the mixin.\n\nRead more on using connectors: https://alg.li/vue-custom`\n      );\n    }\n  },\n  [isVue3 ? 'beforeUnmount' : 'beforeDestroy']() {\n    if (this.widget) {\n      this.getParentIndex().removeWidgets([this.widget]);\n    }\n  },\n  watch: {\n    widgetParams: {\n      handler(nextWidgetParams) {\n        this.state = null;\n        this.getParentIndex().removeWidgets([this.widget]);\n        this.widget = _objectSpread(\n          this.factory(nextWidgetParams),\n          additionalProperties\n        );\n        this.getParentIndex().addWidgets([this.widget]);\n      },\n      deep: true,\n    },\n  },\n  methods: {\n    updateState(state = {}, isFirstRender) {\n      if (!isFirstRender) {\n        // Avoid updating the state on first render\n        // otherwise there will be a flash of placeholder data\n        this.state = state;\n      }\n    },\n  },\n});\n","import { isVue3 } from '../util/vue-compat';\nimport mitt from 'mitt';\n\nexport const PANEL_EMITTER_NAMESPACE = 'instantSearchPanelEmitter';\nexport const PANEL_CHANGE_EVENT = 'PANEL_CHANGE_EVENT';\n\nexport const createPanelProviderMixin = () => ({\n  props: {\n    emitter: {\n      type: Object,\n      required: false,\n      default() {\n        return mitt();\n      },\n    },\n  },\n  provide() {\n    return {\n      [PANEL_EMITTER_NAMESPACE]: this.emitter,\n    };\n  },\n  data() {\n    return {\n      canRefine: true,\n    };\n  },\n  created() {\n    this.emitter.on(PANEL_CHANGE_EVENT, (value) => {\n      this.updateCanRefine(value);\n    });\n  },\n  [isVue3 ? 'beforeUnmount' : 'beforeDestroy']() {\n    this.emitter.all.clear();\n  },\n  methods: {\n    updateCanRefine(value) {\n      this.canRefine = value;\n    },\n  },\n});\n\nexport const createPanelConsumerMixin = ({\n  mapStateToCanRefine = (state) => Boolean(state.canRefine),\n} = {}) => ({\n  inject: {\n    emitter: {\n      from: PANEL_EMITTER_NAMESPACE,\n      default() {\n        return {\n          emit: () => {},\n        };\n      },\n    },\n  },\n  data() {\n    return {\n      state: null,\n      hasAlreadyEmitted: false,\n    };\n  },\n  watch: {\n    state: {\n      immediate: true,\n      handler(nextState, previousState) {\n        if (!nextState) {\n          return;\n        }\n\n        const previousCanRefine = mapStateToCanRefine(previousState || {});\n        const nextCanRefine = mapStateToCanRefine(nextState);\n\n        if (!this.hasAlreadyEmitted || previousCanRefine !== nextCanRefine) {\n          this.emitter.emit(PANEL_CHANGE_EVENT, nextCanRefine);\n          this.hasAlreadyEmitted = true;\n        }\n      },\n    },\n  },\n});\n","import { createWidgetMixin } from '../mixins/widget';\nimport { createSuitMixin } from '../mixins/suit';\nimport { connectConfigure } from 'instantsearch.js/es/connectors';\nimport { isVue3, renderCompat } from '../util/vue-compat';\n\nexport default {\n  inheritAttrs: false,\n  name: 'AisConfigure',\n  mixins: [\n    createSuitMixin({ name: 'Configure' }),\n    createWidgetMixin(\n      {\n        connector: connectConfigure,\n      },\n      {\n        $$widgetType: 'ais.configure',\n      }\n    ),\n  ],\n  computed: {\n    widgetParams() {\n      return {\n        searchParameters: this.$attrs,\n      };\n    },\n  },\n  render: renderCompat(function (h) {\n    const slot = isVue3 ? this.$slots.default : this.$scopedSlots.default;\n\n    if (!this.state || !slot) {\n      return null;\n    }\n\n    return h(\n      'div',\n      {\n        class: this.suit(),\n      },\n      [\n        slot({\n          refine: this.state.refine,\n          searchParameters: this.state.widgetParams.searchParameters,\n        }),\n      ]\n    );\n  }),\n};\n","import { createWidgetMixin } from '../mixins/widget';\nimport { EXPERIMENTAL_connectConfigureRelatedItems } from 'instantsearch.js/es/connectors';\n\nexport default {\n  inheritAttrs: false,\n  name: 'AisExperimentalConfigureRelatedItems',\n  mixins: [\n    createWidgetMixin(\n      {\n        connector: EXPERIMENTAL_connectConfigureRelatedItems,\n      },\n      {\n        $$widgetType: 'ais.configureRelatedItems',\n      }\n    ),\n  ],\n  props: {\n    hit: {\n      type: Object,\n      required: true,\n    },\n    matchingPatterns: {\n      type: Object,\n      required: true,\n    },\n    transformSearchParameters: {\n      type: Function,\n      required: false,\n    },\n  },\n  computed: {\n    widgetParams() {\n      return {\n        hit: this.hit,\n        matchingPatterns: this.matchingPatterns,\n        transformSearchParameters: this.transformSearchParameters,\n      };\n    },\n  },\n  render() {\n    return null;\n  },\n};\n","/**\n * This implementation is taken from Lodash implementation.\n * See: https://github.com/lodash/lodash/blob/4.17.11-npm/unescape.js\n */\n\n/** Used to map HTML entities to characters. */\nconst htmlUnescapes = {\n  '&amp;': '&',\n  '&lt;': '<',\n  '&gt;': '>',\n  '&quot;': '\"',\n  '&#39;': \"'\",\n};\n\n/** Used to match HTML entities and HTML characters. */\nconst reEscapedHtml = /&(?:amp|lt|gt|quot|#39);/g;\nconst reHasEscapedHtml = RegExp(reEscapedHtml.source);\n\n/**\n * The inverse of `_.escape`; this method converts the HTML entities\n * `&amp;`, `&lt;`, `&gt;`, `&quot;`, and `&#39;` in `string` to\n * their corresponding characters.\n *\n * **Note:** No other HTML entities are unescaped. To unescape additional\n * HTML entities use a third-party library like [_he_](https://mths.be/he).\n *\n * @static\n * @memberOf _\n * @since 0.6.0\n * @category String\n * @param {string} [string=''] The string to unescape.\n * @returns {string} Returns the unescaped string.\n * @example\n *\n * _.unescape('fred, barney, &amp; pebbles');\n * // => 'fred, barney, & pebbles'\n */\nexport function unescape(string) {\n  return string && reHasEscapedHtml.test(string)\n    ? string.replace(reEscapedHtml, (character) => htmlUnescapes[character])\n    : string;\n}\n","// copied from React InstantSearch\nimport { getPropertyByPath } from 'instantsearch.js/es/lib/utils';\nimport { unescape } from '../util/unescape';\n\nconst TAG_PLACEHOLDER = {\n  highlightPreTag: '__ais-highlight__',\n  highlightPostTag: '__/ais-highlight__',\n};\n\n/**\n * Parses an highlighted attribute into an array of objects with the string value, and\n * a boolean that indicated if this part is highlighted.\n *\n * @param {string} preTag - string used to identify the start of an highlighted value\n * @param {string} postTag - string used to identify the end of an highlighted value\n * @param {string} highlightedValue - highlighted attribute as returned by Algolia highlight feature\n * @return {object[]} - An array of {value: string, isHighlighted: boolean}.\n */\nfunction parseHighlightedAttribute({ preTag, postTag, highlightedValue = '' }) {\n  const splitByPreTag = highlightedValue.split(preTag);\n  const firstValue = splitByPreTag.shift();\n  const elements =\n    firstValue === '' ? [] : [{ value: firstValue, isHighlighted: false }];\n\n  if (postTag === preTag) {\n    let isHighlighted = true;\n    splitByPreTag.forEach((split) => {\n      elements.push({ value: split, isHighlighted });\n      isHighlighted = !isHighlighted;\n    });\n  } else {\n    splitByPreTag.forEach((split) => {\n      const splitByPostTag = split.split(postTag);\n\n      elements.push({\n        value: splitByPostTag[0],\n        isHighlighted: true,\n      });\n\n      if (splitByPostTag[1] !== '') {\n        elements.push({\n          // Vue removes nodes which are just a single space (vuejs/vue#9208),\n          // we replace this by two spaces, which does not have an impact,\n          // unless someone would have `white-space: pre` on the highlights\n          value: splitByPostTag[1] === ' ' ? '  ' : splitByPostTag[1],\n          isHighlighted: false,\n        });\n      }\n    });\n  }\n\n  return elements;\n}\n\n/**\n * Find an highlighted attribute given an `attribute` and an `highlightProperty`, parses it,\n * and provided an array of objects with the string value and a boolean if this\n * value is highlighted.\n *\n * In order to use this feature, highlight must be activated in the configuration of\n * the index. The `preTag` and `postTag` attributes are respectively highlightPreTag and\n * highlightPostTag in Algolia configuration.\n *\n * @param {string} preTag - string used to identify the start of an highlighted value\n * @param {string} postTag - string used to identify the end of an highlighted value\n * @param {string} highlightProperty - the property that contains the highlight structure in the results\n * @param {string} attribute - the highlighted attribute to look for\n * @param {object} hit - the actual hit returned by Algolia.\n * @return {object[]} - An array of {value: string, isHighlighted: boolean}.\n */\nexport function parseAlgoliaHit({\n  preTag = TAG_PLACEHOLDER.highlightPreTag,\n  postTag = TAG_PLACEHOLDER.highlightPostTag,\n  highlightProperty,\n  attribute,\n  hit,\n}) {\n  if (!hit) throw new Error('`hit`, the matching record, must be provided');\n\n  const highlightObject =\n    getPropertyByPath(hit[highlightProperty], attribute) || {};\n\n  if (Array.isArray(highlightObject)) {\n    return highlightObject.map((item) =>\n      parseHighlightedAttribute({\n        preTag,\n        postTag,\n        highlightedValue: unescape(item.value),\n      })\n    );\n  }\n\n  return parseHighlightedAttribute({\n    preTag,\n    postTag,\n    highlightedValue: unescape(highlightObject.value),\n  });\n}\n","<template>\n  <span :class=\"suit()\">\n    <component\n      v-for=\"({ value, isHighlighted }, index) in parsedHighlights\"\n      :class=\"[isHighlighted && suit('highlighted')]\"\n      :key=\"index\"\n      :is=\"isHighlighted ? highlightedTagName : TextNode\"\n      >{{ value }}</component\n    >\n  </span>\n</template>\n\n<script>\nimport { getDefaultSlot, renderCompat, isVue3 } from '../util/vue-compat';\nimport { parseAlgoliaHit } from '../util/parseAlgoliaHit';\n\nconst TextNode = isVue3\n  ? (props, context) => context.slots.default()\n  : {\n      render: renderCompat(function () {\n        return getDefaultSlot(this);\n      }),\n    };\n\nexport default {\n  name: 'AisHighlighter',\n  props: {\n    hit: {\n      type: Object,\n      required: true,\n    },\n    attribute: {\n      type: String,\n      required: true,\n    },\n    highlightedTagName: {\n      type: String,\n      default: 'mark',\n    },\n    suit: {\n      type: Function,\n      required: true,\n    },\n    highlightProperty: {\n      type: String,\n      required: true,\n    },\n    preTag: {\n      type: String,\n      required: true,\n    },\n    postTag: {\n      type: String,\n      required: true,\n    },\n  },\n  data() {\n    return { TextNode };\n  },\n  computed: {\n    parsedHighlights() {\n      return parseAlgoliaHit({\n        attribute: this.attribute,\n        hit: this.hit,\n        highlightProperty: this.highlightProperty,\n        preTag: this.preTag,\n        postTag: this.postTag,\n      });\n    },\n  },\n};\n</script>\n","import { createSuitMixin } from '../mixins/suit';\nimport { createWidgetMixin } from '../mixins/widget';\nimport indexWidget from 'instantsearch.js/es/widgets/index/index';\nimport { renderCompat, getDefaultSlot } from '../util/vue-compat';\n\n// wrapped in a dummy function, since indexWidget doesn't render\nconst connectIndex = () => indexWidget;\n\nexport default {\n  name: 'AisIndex',\n  mixins: [\n    createSuitMixin({ name: 'Index' }),\n    createWidgetMixin(\n      { connector: connectIndex },\n      {\n        $$widgetType: 'ais.index',\n      }\n    ),\n  ],\n  provide() {\n    return {\n      // The widget is created & registered by widgetMixin, accessor is needed\n      // because provide is not reactive.\n      $_ais_getParentIndex: () => this.widget,\n    };\n  },\n  props: {\n    indexName: {\n      type: String,\n      required: true,\n    },\n    indexId: {\n      type: String,\n      required: false,\n    },\n  },\n  render: renderCompat(function (h) {\n    return h('div', {}, getDefaultSlot(this));\n  }),\n  computed: {\n    widgetParams() {\n      return {\n        indexName: this.indexName,\n        indexId: this.indexId,\n      };\n    },\n  },\n};\n","import { createSuitMixin } from '../mixins/suit';\nimport { version } from '../../package.json'; // rollup does pick only what needed from json\nimport { _objectSpread } from './polyfills';\nimport { isVue3, version as vueVersion } from './vue-compat';\nimport { warn } from './warn';\n\nexport const createInstantSearchComponent = (component) =>\n  _objectSpread(\n    {\n      mixins: [createSuitMixin({ name: 'InstantSearch' })],\n      provide() {\n        return {\n          $_ais_instantSearchInstance: this.instantSearchInstance,\n        };\n      },\n      watch: {\n        searchClient(searchClient) {\n          warn(\n            false,\n            'The `search-client` prop of `<ais-instant-search>` changed between renders, which may cause more search requests than necessary. If this is an unwanted behavior, please provide a stable reference: https://www.algolia.com/doc/api-reference/widgets/instantsearch/vue/#widget-param-search-client'\n          );\n\n          this.instantSearchInstance.helper.setClient(searchClient).search();\n        },\n        indexName(indexName) {\n          this.instantSearchInstance.helper.setIndex(indexName).search();\n        },\n        stalledSearchDelay(stalledSearchDelay) {\n          // private InstantSearch.js API:\n          this.instantSearchInstance._stalledSearchDelay = stalledSearchDelay;\n        },\n        routing() {\n          throw new Error(\n            'routing configuration can not be changed dynamically at this point.' +\n              '\\n\\n' +\n              'Please open a new issue: https://github.com/algolia/instantsearch.js/discussions/new?category=ideas&labels=triage%2cLibrary%3A+Vue+InstantSearch&title=Feature%20request%3A%20dynamic%20props'\n          );\n        },\n        onStateChange() {\n          throw new Error(\n            'onStateChange configuration can not be changed dynamically at this point.' +\n              '\\n\\n' +\n              'Please open a new issue: https://github.com/algolia/instantsearch.js/discussions/new?category=ideas&labels=triage%2cLibrary%3A+Vue+InstantSearch&title=Feature%20request%3A%20dynamic%20props'\n          );\n        },\n        searchFunction(searchFunction) {\n          // private InstantSearch.js API:\n          this.instantSearchInstance._searchFunction = searchFunction;\n        },\n        middlewares: {\n          immediate: true,\n          handler(next, prev) {\n            (prev || [])\n              .filter((middleware) => (next || []).indexOf(middleware) === -1)\n              .forEach((middlewareToRemove) => {\n                this.instantSearchInstance.unuse(middlewareToRemove);\n              });\n\n            (next || [])\n              .filter((middleware) => (prev || []).indexOf(middleware) === -1)\n              .forEach((middlewareToAdd) => {\n                this.instantSearchInstance.use(middlewareToAdd);\n              });\n          },\n        },\n      },\n      created() {\n        const searchClient = this.instantSearchInstance.client;\n        if (typeof searchClient.addAlgoliaAgent === 'function') {\n          searchClient.addAlgoliaAgent(`Vue (${vueVersion})`);\n          searchClient.addAlgoliaAgent(`Vue InstantSearch (${version})`);\n        }\n      },\n      mounted() {\n        // from the documentation: https://vuejs.org/v2/api/#mounted\n        // \"Note that mounted does not guarantee that all child components have also been mounted. If you want to\n        // wait until the entire view has been rendered, you can use vm.$nextTick inside of mounted\"\n        this.$nextTick(() => {\n          if (!this.instantSearchInstance.started) {\n            this.instantSearchInstance.start();\n          }\n        });\n      },\n      [isVue3 ? 'beforeUnmount' : 'beforeDestroy']() {\n        if (this.instantSearchInstance.started) {\n          this.instantSearchInstance.dispose();\n        }\n\n        // a hydrated instance will no longer be hydrated once disposed, and starts from scratch\n        this.instantSearchInstance.__initialSearchResults = undefined;\n      },\n    },\n    component\n  );\n","import instantsearch from 'instantsearch.js/es';\nimport { createInstantSearchComponent } from '../util/createInstantSearchComponent';\nimport { warn } from '../util/warn';\nimport { renderCompat, getDefaultSlot } from '../util/vue-compat';\n\nconst oldApiWarning = `Vue InstantSearch: You used the prop api-key or app-id.\nThese have been replaced by search-client.\n\nSee more info here: https://www.algolia.com/doc/api-reference/widgets/instantsearch/vue/#widget-param-search-client`;\n\nexport default createInstantSearchComponent({\n  name: 'AisInstantSearch',\n  props: {\n    searchClient: {\n      type: Object,\n      required: true,\n    },\n    insightsClient: {\n      type: Function,\n      default: undefined,\n    },\n    indexName: {\n      type: String,\n      required: true,\n    },\n    routing: {\n      default: undefined,\n      validator(value) {\n        if (\n          typeof value === 'boolean' ||\n          (!value.router && !value.stateMapping)\n        ) {\n          warn(\n            'The `routing` option expects an object with `router` and/or `stateMapping`.\\n\\nSee https://www.algolia.com/doc/api-reference/widgets/instantsearch/vue/#widget-param-routing'\n          );\n          return false;\n        }\n        return true;\n      },\n    },\n    stalledSearchDelay: {\n      type: Number,\n      default: undefined,\n    },\n    searchFunction: {\n      type: Function,\n      default: undefined,\n    },\n    onStateChange: {\n      type: Function,\n      default: undefined,\n    },\n    initialUiState: {\n      type: Object,\n      default: undefined,\n    },\n    apiKey: {\n      type: String,\n      default: undefined,\n      validator(value) {\n        if (value) {\n          warn(oldApiWarning);\n        }\n        return false;\n      },\n    },\n    appId: {\n      type: String,\n      default: undefined,\n      validator(value) {\n        if (value) {\n          warn(oldApiWarning);\n        }\n        return false;\n      },\n    },\n    middlewares: {\n      type: Array,\n      default: null,\n    },\n  },\n  data() {\n    return {\n      instantSearchInstance: instantsearch({\n        searchClient: this.searchClient,\n        insightsClient: this.insightsClient,\n        indexName: this.indexName,\n        routing: this.routing,\n        stalledSearchDelay: this.stalledSearchDelay,\n        searchFunction: this.searchFunction,\n        onStateChange: this.onStateChange,\n        initialUiState: this.initialUiState,\n      }),\n    };\n  },\n  render: renderCompat(function (h) {\n    return h(\n      'div',\n      {\n        class: {\n          [this.suit()]: true,\n          [this.suit('', 'ssr')]: false,\n        },\n      },\n      getDefaultSlot(this)\n    );\n  }),\n});\n","import { createInstantSearchComponent } from '../util/createInstantSearchComponent';\nimport { renderCompat, getDefaultSlot } from '../util/vue-compat';\n\nexport default createInstantSearchComponent({\n  name: 'AisInstantSearchSsr',\n  inject: {\n    $_ais_ssrInstantSearchInstance: {\n      default() {\n        throw new Error('`createServerRootMixin` is required when using SSR.');\n      },\n    },\n  },\n  data() {\n    return {\n      instantSearchInstance: this.$_ais_ssrInstantSearchInstance,\n    };\n  },\n  render: renderCompat(function (h) {\n    return h(\n      'div',\n      {\n        class: {\n          [this.suit()]: true,\n          [this.suit('', 'ssr')]: true,\n        },\n      },\n      getDefaultSlot(this)\n    );\n  }),\n});\n","import { createSuitMixin } from '../mixins/suit';\nimport { createWidgetMixin } from '../mixins/widget';\nimport { connectQueryRules } from 'instantsearch.js/es/connectors';\n\nexport default {\n  name: 'AisQueryRuleContext',\n  mixins: [\n    createSuitMixin({ name: 'QueryRuleContext' }),\n    createWidgetMixin(\n      {\n        connector: connectQueryRules,\n      },\n      {\n        $$widgetType: 'ais.queryRuleContext',\n      }\n    ),\n  ],\n  props: {\n    trackedFilters: {\n      type: Object,\n      required: true,\n    },\n    transformRuleContexts: {\n      type: Function,\n      required: false,\n      default: undefined,\n    },\n  },\n  computed: {\n    widgetParams() {\n      return {\n        trackedFilters: this.trackedFilters,\n        transformRuleContexts: this.transformRuleContexts,\n      };\n    },\n  },\n  render() {\n    return null;\n  },\n};\n","import { createWidgetMixin } from '../mixins/widget';\nimport { connectDynamicWidgets } from 'instantsearch.js/es/connectors';\nimport { createSuitMixin } from '../mixins/suit';\nimport { _objectSpread } from '../util/polyfills';\nimport { isVue3, renderCompat, getDefaultSlot } from '../util/vue-compat';\n\nfunction getWidgetAttribute(vnode) {\n  const props = isVue3\n    ? vnode.props\n    : vnode.componentOptions && vnode.componentOptions.propsData;\n  if (props) {\n    if (props.attribute) {\n      return props.attribute;\n    }\n    if (Array.isArray(props.attributes)) {\n      return props.attributes[0];\n    }\n  }\n\n  let children;\n  if (isVue3) {\n    children =\n      vnode.children && vnode.children.default && vnode.children.default();\n  } else {\n    children =\n      vnode.componentOptions && vnode.componentOptions.children\n        ? vnode.componentOptions.children\n        : vnode.children;\n  }\n\n  if (Array.isArray(children)) {\n    // return first child with a truthy attribute\n    return children.reduce(\n      (acc, curr) => acc || getWidgetAttribute(curr),\n      undefined\n    );\n  }\n\n  return undefined;\n}\n\nexport default {\n  name: 'AisDynamicWidgets',\n  mixins: [\n    createWidgetMixin(\n      {\n        connector: connectDynamicWidgets,\n      },\n      {\n        $$widgetType: 'ais.dynamicWidgets',\n      }\n    ),\n    createSuitMixin({ name: 'DynamicWidgets' }),\n  ],\n  props: {\n    transformItems: {\n      type: Function,\n      default: undefined,\n    },\n    facets: {\n      type: Array,\n      default: undefined,\n    },\n    maxValuesPerFacet: {\n      type: Number,\n      default: undefined,\n    },\n  },\n  render: renderCompat(function (h) {\n    const components = new Map();\n\n    (getDefaultSlot(this) || []).forEach((vnode) => {\n      const attribute = getWidgetAttribute(vnode);\n      if (attribute) {\n        components.set(\n          attribute,\n          h('div', { key: attribute, class: [this.suit('widget')] }, [vnode])\n        );\n      }\n    });\n\n    // by default, render everything, but hidden so that the routing doesn't disappear\n    if (!this.state) {\n      const allComponents = [];\n      components.forEach((component) => allComponents.push(component));\n\n      return h(\n        'div',\n        _objectSpread(\n          {\n            class: [this.suit()],\n          },\n          { attrs: { hidden: true } }\n        ),\n        allComponents\n      );\n    }\n\n    return h(\n      'div',\n      { class: [this.suit()] },\n      this.state.attributesToRender.map((attribute) =>\n        components.get(attribute)\n      )\n    );\n  }),\n  computed: {\n    widgetParams() {\n      return {\n        transformItems: this.transformItems,\n        facets: this.facets,\n        maxValuesPerFacet: this.maxValuesPerFacet,\n        // we do not pass \"widgets\" to the connector, since Vue is in charge of rendering\n        widgets: [],\n      };\n    },\n  },\n};\n","import AisDynamicWidgets from './DynamicWidgets';\nimport { warn } from '../util/warn';\n\n// @MAJOR remove this file\nexport default Object.assign({}, AisDynamicWidgets, {\n  name: 'AisExperimentalDynamicWidgets',\n  mounted() {\n    warn('Use AisDynamicWidgets instead of AisExperimentalDynamicWidgets.');\n  },\n});\n","/* eslint import/namespace: ['error', { allowComputed: true }]*/\n\nimport * as widgets from './widgets';\n\nexport const plugin = {\n  install(localVue) {\n    Object.keys(widgets).forEach((widgetName) => {\n      localVue.component(widgets[widgetName].name, widgets[widgetName]);\n    });\n  },\n};\n","import instantsearch from 'instantsearch.js/es';\nimport { isVue3, isVue2, Vue2, createSSRApp } from './vue-compat';\nimport { warn } from './warn';\n\nfunction walkIndex(indexWidget, visit) {\n  visit(indexWidget);\n\n  return indexWidget.getWidgets().forEach((widget) => {\n    if (widget.$$type !== 'ais.index') return;\n    visit(widget);\n    walkIndex(widget, visit);\n  });\n}\n\nfunction searchOnlyWithDerivedHelpers(helper) {\n  return new Promise((resolve, reject) => {\n    helper.searchOnlyWithDerivedHelpers();\n\n    // we assume all derived helpers resolve at least in the same tick\n    helper.derivedHelpers[0].on('result', () => {\n      resolve();\n    });\n\n    helper.derivedHelpers.forEach((derivedHelper) =>\n      derivedHelper.on('error', (e) => {\n        reject(e);\n      })\n    );\n  });\n}\n\nfunction defaultCloneComponent(componentInstance, { mixins = [] } = {}) {\n  const options = {\n    serverPrefetch: undefined,\n    fetch: undefined,\n    _base: undefined,\n    name: 'ais-ssr-root-component',\n  };\n\n  let app;\n\n  if (isVue3) {\n    const appOptions = Object.assign({}, componentInstance.$options, options);\n    appOptions.mixins = [...mixins, ...(appOptions.mixins || [])];\n    app = createSSRApp(appOptions);\n    if (componentInstance.$router) {\n      app.use(componentInstance.$router);\n    }\n    if (componentInstance.$store) {\n      app.use(componentInstance.$store);\n    }\n  } else {\n    // copy over global Vue APIs\n    options.router = componentInstance.$router;\n    options.store = componentInstance.$store;\n\n    const Extended = componentInstance.$vnode\n      ? componentInstance.$vnode.componentOptions.Ctor.extend(options)\n      : Vue2.component(\n          options.name,\n          Object.assign({}, componentInstance.$options, options)\n        );\n\n    app = new Extended({\n      propsData: componentInstance.$options.propsData,\n      mixins: [...mixins],\n    });\n  }\n\n  // https://stackoverflow.com/a/48195006/3185307\n  app.$slots = componentInstance.$slots;\n  app.$root = componentInstance.$root;\n  if (isVue2) {\n    app.$options.serverPrefetch = [];\n  }\n\n  return app;\n}\n\nfunction augmentInstantSearch(instantSearchOptions, cloneComponent) {\n  const search = instantsearch(instantSearchOptions);\n\n  let initialResults;\n\n  /**\n   * main API for SSR, called in serverPrefetch of a root component which contains instantsearch\n   * @param {Object} props the object including `component` and `renderToString`\n   * @param {Object} props.component the calling component's `this`\n   * @param {Function} props.renderToString the function to render componentInstance to string\n   * @returns {Promise} result of the search, to save for .hydrate\n   */\n  search.findResultsState = function ({ component, renderToString }) {\n    if (!renderToString) {\n      throw new Error(\n        'findResultsState requires `renderToString: (component) => Promise<string>` in the first argument.'\n      );\n    }\n\n    let app;\n    let instance;\n\n    return Promise.resolve()\n      .then(() => {\n        app = cloneComponent(component, {\n          mixins: [\n            {\n              beforeCreate() {\n                const descriptor = Object.getOwnPropertyDescriptor(\n                  component,\n                  '$nuxt'\n                );\n\n                const isWritable = descriptor\n                  ? descriptor.writable || descriptor.set\n                  : false;\n\n                if (component.$nuxt && isWritable) {\n                  // In case of Nuxt (3), we ensure the context is shared between\n                  // the real and cloned component\n                  this.$nuxt = component.$nuxt;\n                }\n              },\n              created() {\n                instance = this.instantsearch;\n\n                instance.start();\n                // although we use start for initializing the main index,\n                // we don't want to send search requests yet\n                instance.started = false;\n              },\n            },\n          ],\n        });\n      })\n      .then(() => renderToString(app))\n      .then(() => searchOnlyWithDerivedHelpers(instance.mainHelper))\n      .then(() => {\n        initialResults = {};\n        walkIndex(instance.mainIndex, (widget) => {\n          initialResults[widget.getIndexId()] = {\n            // copy just the values of SearchParameters, not the functions\n            state: Object.entries(widget.getHelper().state).reduce(\n              (acc, [key, value]) => {\n                // eslint-disable-next-line no-param-reassign\n                acc[key] = value;\n                return acc;\n              },\n              {}\n            ),\n            results: widget.getResults()._rawResults,\n          };\n        });\n\n        search.hydrate(initialResults);\n        return search.getState();\n      });\n  };\n\n  /**\n   * @returns {Promise} result state to serialize and enter into .hydrate\n   */\n  search.getState = function () {\n    if (!initialResults) {\n      throw new Error('You need to wait for findResultsState to finish');\n    }\n    return initialResults;\n  };\n\n  /**\n   * make sure correct data is available in each widget's state.\n   * called in widget mixin with (this.widget, this)\n   *\n   * @param {object} widget The widget instance\n   * @param {object} parent The local parent index\n   * @returns {void}\n   */\n  search.__forceRender = function (widget, parent) {\n    const results = parent.getResults();\n\n    // this happens when a different InstantSearch gets rendered initially,\n    // after the hydrate finished. There's thus no initial results available.\n    if (results === null) {\n      return;\n    }\n\n    const state = results._state;\n\n    const localHelper = parent.getHelper();\n    // helper gets created in init, but that means it doesn't get the injected\n    // parameters, because those are from the lastResults\n    localHelper.state = state;\n\n    widget.render({\n      helper: localHelper,\n      results,\n      scopedResults: parent.getScopedResults(),\n      parent,\n      state,\n      templatesConfig: {},\n      createURL: parent.createURL,\n      instantSearchInstance: search,\n      searchMetadata: {\n        isSearchStalled: false,\n      },\n    });\n  };\n\n  /**\n   * Called both in server\n   * @param {object} results a map of indexId: SearchResults\n   * @returns {void}\n   */\n  search.hydrate = function (results) {\n    if (!results) {\n      warn(\n        'The result of `findResultsState()` needs to be passed to `hydrate()`.'\n      );\n      return;\n    }\n\n    search._initialResults = results;\n\n    search.start();\n    search.started = false;\n  };\n  return search;\n}\n\nexport function createServerRootMixin(instantSearchOptions = {}) {\n  const { $cloneComponent = defaultCloneComponent } = instantSearchOptions;\n\n  const search = augmentInstantSearch(instantSearchOptions, $cloneComponent);\n\n  // put this in the user's root Vue instance\n  // we can then reuse that InstantSearch instance seamlessly from `ais-instant-search-ssr`\n  const rootMixin = {\n    provide() {\n      return {\n        $_ais_ssrInstantSearchInstance: this.instantsearch,\n      };\n    },\n    data() {\n      return {\n        // this is in data, so that the real & cloned render do not share\n        // the same instantsearch instance.\n        instantsearch: search,\n      };\n    },\n  };\n\n  return rootMixin;\n}\n"],"names":["suit","widgetName","element","modifier","Error","const","elements","push","join","createSuitMixin","props","classNames","type","Object","default","undefined","methods","className","name","userClassName","this","_objectSpread","target","i","arguments","length","source","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","_defineProperty","obj","value","defineProperty","configurable","writable","isVue2","isVue3","Vue2","Vue","version","renderCompat","fn","createElement","call","getDefaultSlot","component","$slots","cache","Set","warn","message","has","add","console","createWidgetMixin","additionalProperties","inject","instantSearchInstance","from","tag","$options","_componentTag","TypeError","getParentIndex","mainIndex","data","state","created","connector","factory","updateState","widget","widgetParams","addWidgets","_initialResults","started","__forceRender","removeWidgets","watch","handler","nextWidgetParams","deep","isFirstRender","PANEL_EMITTER_NAMESPACE","PANEL_CHANGE_EVENT","createPanelProviderMixin","emitter","required","mitt","provide","canRefine","on","updateCanRefine","all","clear","createPanelConsumerMixin","Boolean","emit","hasAlreadyEmitted","immediate","nextState","previousState","previousCanRefine","mapStateToCanRefine","nextCanRefine","inheritAttrs","mixins","connectConfigure","$$widgetType","computed","searchParameters","$attrs","render","h","slot","$scopedSlots","class","refine","EXPERIMENTAL_connectConfigureRelatedItems","hit","matchingPatterns","transformSearchParameters","Function","htmlUnescapes","&amp;","&lt;","&gt;","&quot;","&#39;","reEscapedHtml","reHasEscapedHtml","RegExp","unescape","string","test","replace","character","TAG_PLACEHOLDER","highlightPreTag","highlightPostTag","parseHighlightedAttribute","splitByPreTag","highlightedValue","split","preTag","firstValue","shift","isHighlighted","postTag","let","splitByPostTag","parseAlgoliaHit","highlightObject","getPropertyByPath","highlightProperty","attribute","Array","isArray","map","item","connectIndex","indexWidget","$_ais_getParentIndex","indexName","String","indexId","createInstantSearchComponent","$_ais_instantSearchInstance","searchClient","helper","setClient","search","setIndex","stalledSearchDelay","_stalledSearchDelay","routing","onStateChange","searchFunction","_searchFunction","middlewares","next","prev","middleware","indexOf","middlewareToRemove","unuse","middlewareToAdd","use","client","addAlgoliaAgent","vueVersion","mounted","$nextTick","start","dispose","__initialSearchResults","oldApiWarning","insightsClient","validator","router","stateMapping","Number","initialUiState","apiKey","appId","instantsearch","$_ais_ssrInstantSearchInstance","connectQueryRules","trackedFilters","transformRuleContexts","getWidgetAttribute","vnode","children","componentOptions","propsData","attributes","reduce","acc","curr","connectDynamicWidgets","transformItems","facets","maxValuesPerFacet","components","Map","set","allComponents","attrs","hidden","attributesToRender","get","widgets","assign","AisDynamicWidgets","plugin","install","localVue","walkIndex","visit","getWidgets","$$type","searchOnlyWithDerivedHelpers","Promise","resolve","reject","derivedHelpers","derivedHelper","e","defaultCloneComponent","componentInstance","app","options","serverPrefetch","fetch","_base","$router","store","$store","$vnode","Ctor","extend","$root","augmentInstantSearch","instantSearchOptions","cloneComponent","initialResults","findResultsState","instance","renderToString","then","beforeCreate","descriptor","isWritable","$nuxt","mainHelper","getIndexId","entries","getHelper","results","getResults","_rawResults","hydrate","getState","parent","_state","localHelper","scopedResults","getScopedResults","templatesConfig","createURL","searchMetadata","isSearchStalled","createServerRootMixin","$cloneComponent"],"mappings":"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"}