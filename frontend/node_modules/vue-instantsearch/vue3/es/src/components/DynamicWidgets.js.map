{"version":3,"file":"DynamicWidgets.js","sources":["../../../../src/components/DynamicWidgets.js"],"sourcesContent":["import { createWidgetMixin } from '../mixins/widget';\nimport { connectDynamicWidgets } from 'instantsearch.js/es/connectors';\nimport { createSuitMixin } from '../mixins/suit';\nimport { _objectSpread } from '../util/polyfills';\nimport { isVue3, renderCompat, getDefaultSlot } from '../util/vue-compat';\n\nfunction getWidgetAttribute(vnode) {\n  const props = isVue3\n    ? vnode.props\n    : vnode.componentOptions && vnode.componentOptions.propsData;\n  if (props) {\n    if (props.attribute) {\n      return props.attribute;\n    }\n    if (Array.isArray(props.attributes)) {\n      return props.attributes[0];\n    }\n  }\n\n  let children;\n  if (isVue3) {\n    children =\n      vnode.children && vnode.children.default && vnode.children.default();\n  } else {\n    children =\n      vnode.componentOptions && vnode.componentOptions.children\n        ? vnode.componentOptions.children\n        : vnode.children;\n  }\n\n  if (Array.isArray(children)) {\n    // return first child with a truthy attribute\n    return children.reduce(\n      (acc, curr) => acc || getWidgetAttribute(curr),\n      undefined\n    );\n  }\n\n  return undefined;\n}\n\nexport default {\n  name: 'AisDynamicWidgets',\n  mixins: [\n    createWidgetMixin(\n      {\n        connector: connectDynamicWidgets,\n      },\n      {\n        $$widgetType: 'ais.dynamicWidgets',\n      }\n    ),\n    createSuitMixin({ name: 'DynamicWidgets' }),\n  ],\n  props: {\n    transformItems: {\n      type: Function,\n      default: undefined,\n    },\n    facets: {\n      type: Array,\n      default: undefined,\n    },\n    maxValuesPerFacet: {\n      type: Number,\n      default: undefined,\n    },\n  },\n  render: renderCompat(function (h) {\n    const components = new Map();\n\n    (getDefaultSlot(this) || []).forEach((vnode) => {\n      const attribute = getWidgetAttribute(vnode);\n      if (attribute) {\n        components.set(\n          attribute,\n          h('div', { key: attribute, class: [this.suit('widget')] }, [vnode])\n        );\n      }\n    });\n\n    // by default, render everything, but hidden so that the routing doesn't disappear\n    if (!this.state) {\n      const allComponents = [];\n      components.forEach((component) => allComponents.push(component));\n\n      return h(\n        'div',\n        _objectSpread(\n          {\n            class: [this.suit()],\n          },\n          { attrs: { hidden: true } }\n        ),\n        allComponents\n      );\n    }\n\n    return h(\n      'div',\n      { class: [this.suit()] },\n      this.state.attributesToRender.map((attribute) =>\n        components.get(attribute)\n      )\n    );\n  }),\n  computed: {\n    widgetParams() {\n      return {\n        transformItems: this.transformItems,\n        facets: this.facets,\n        maxValuesPerFacet: this.maxValuesPerFacet,\n        // we do not pass \"widgets\" to the connector, since Vue is in charge of rendering\n        widgets: [],\n      };\n    },\n  },\n};\n"],"names":["name","mixins","createWidgetMixin","connector","connectDynamicWidgets","$$widgetType","createSuitMixin","props","transformItems","type","Function","default","undefined","facets","Array","maxValuesPerFacet","Number","render","renderCompat","h","components","Map","getDefaultSlot","this","forEach","vnode","const","attribute","getWidgetAttribute","children","isArray","attributes","reduce","acc","curr","set","key","class","suit","state","allComponents","component","push","_objectSpread","attrs","hidden","attributesToRender","map","get","computed","widgetParams","widgets"],"mappings":"mVAyCe,CACbA,KAAM,oBACNC,OAAQ,CACNC,EACE,CACEC,UAAWC,GAEb,CACEC,aAAc,uBAGlBC,EAAgB,CAAEN,KAAM,oBAE1BO,MAAO,CACLC,eAAgB,CACdC,KAAMC,SACNC,aAASC,GAEXC,OAAQ,CACNJ,KAAMK,MACNH,aAASC,GAEXG,kBAAmB,CACjBN,KAAMO,OACNL,aAASC,IAGbK,OAAQC,EAAa,SAAUC,cACvBC,EAAa,IAAIC,IAavB,IAXCC,EAAeC,OAAS,IAAIC,iBAASC,GACpCC,IAAMC,EAlEZ,SAASC,EAAmBH,GAC1BC,IAYIG,EAZEtB,EACFkB,EAAMlB,MAEV,GAAIA,EAAO,CACT,GAAIA,EAAMoB,UACR,OAAOpB,EAAMoB,UAEf,GAAIb,MAAMgB,QAAQvB,EAAMwB,YACtB,OAAOxB,EAAMwB,WAAW,GAe5B,GATEF,EACEJ,EAAMI,UAAYJ,EAAMI,SAASlB,SAAWc,EAAMI,SAASlB,UAQ3DG,MAAMgB,QAAQD,GAEhB,OAAOA,EAASG,gBACbC,EAAKC,UAASD,GAAOL,EAAmBM,SACzCtB,GAsCkBgB,CAAmBH,GACjCE,GACFP,EAAWe,IACTR,EACAR,EAAE,MAAO,CAAEiB,IAAKT,EAAWU,MAAO,CAACd,EAAKe,KAAK,YAAc,CAACb,QAM7DF,KAAKgB,MAAO,CACfb,IAAMc,EAAgB,GAGtB,OAFApB,EAAWI,iBAASiB,UAAcD,EAAcE,KAAKD,KAE9CtB,EACL,MACAwB,EACE,CACEN,MAAO,CAACd,KAAKe,SAEf,CAAEM,MAAO,CAAEC,QAAQ,KAErBL,GAIJ,OAAOrB,EACL,MACA,CAAEkB,MAAO,CAACd,KAAKe,SACff,KAAKgB,MAAMO,mBAAmBC,aAAKpB,UACjCP,EAAW4B,IAAIrB,QAIrBsB,SAAU,CACRC,wBACE,MAAO,CACL1C,eAAgBe,KAAKf,eACrBK,OAAQU,KAAKV,OACbE,kBAAmBQ,KAAKR,kBAExBoC,QAAS"}